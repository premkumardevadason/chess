<!DOCTYPE html>
<html>
<head>
    <title>Chess Game</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' ws: wss:;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <style>
        body { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; font-family: Arial, sans-serif; }
        h1 { text-align: center; margin-bottom: 20px; }
        .chess-board { display: inline-block; border: 2px solid #333; }
        .board-row { display: flex; }
        .board-cell { width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; font-size: 40px; cursor: pointer; }
        .light { background-color: #f0d9b5; }
        .dark { background-color: #b58863; }
        .selected { background-color: #ffff00 !important; }
        .king-in-check { border: 4px solid #ff0000 !important; box-sizing: border-box; }
        .game-info { margin-bottom: 20px; text-align: center; }
        .security-notice { font-size: 12px; color: #666; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Chess Game</h1>
    <div class="game-info">
        <p id="turn-info">Your turn (White)</p>
        <button onclick="newGame()">New Game</button>
        <button onclick="trainAI()">Start All Training</button>
        <button onclick="stopTraining()">Stop All Training</button>
        <button onclick="deleteTraining()">Delete Training File</button>
        <button onclick="checkAIStatus()">Check All AI Status</button>
        <button onclick="evaluateTrainingQuality()">Evaluate Training Quality</button>
        <div id="training-status"></div>
    </div>
    <div class="chess-board" id="chess-board"></div>
    
    <script>
        function testQTable() {
            console.log('testQTable called');
            document.getElementById('training-status').textContent = 'Testing Q-table...';
            fetch('/api/test-qtable?entries=100', { method: 'POST' })
                .then(response => response.text())
                .then(message => {
                    document.getElementById('training-status').textContent = message;
                    setTimeout(() => document.getElementById('training-status').textContent = '', 5000);
                })
                .catch(error => {
                    document.getElementById('training-status').textContent = 'Error: ' + error.message;
                });
        }
        
        function testTraining() {
            console.log('testTraining called');
            document.getElementById('training-status').textContent = 'Test training...';
            fetch('/api/test-training?games=5', { method: 'POST' })
                .then(response => response.text())
                .then(message => {
                    document.getElementById('training-status').textContent = message;
                    setTimeout(() => document.getElementById('training-status').textContent = '', 5000);
                })
                .catch(error => {
                    document.getElementById('training-status').textContent = 'Error: ' + error.message;
                });
        }
        
        function verifyQTable() {
            console.log('verifyQTable called');
            document.getElementById('training-status').textContent = 'Verifying Q-table...';
            fetch('/api/verify-qtable', { method: 'POST' })
                .then(response => response.text())
                .then(message => {
                    document.getElementById('training-status').textContent = message;
                    setTimeout(() => document.getElementById('training-status').textContent = '', 5000);
                })
                .catch(error => {
                    document.getElementById('training-status').textContent = 'Error: ' + error.message;
                });
        }
        
        function checkAIStatus() {
            console.log('checkAIStatus called');
            document.getElementById('training-status').textContent = 'Checking AI status...';
            fetch('/api/ai-status')
                .then(response => response.text())
                .then(message => {
                    document.getElementById('training-status').innerHTML = message.replace(/\n/g, '<br>');
                    setTimeout(() => document.getElementById('training-status').textContent = '', 10000);
                })
                .catch(error => {
                    document.getElementById('training-status').textContent = 'Error: ' + error.message;
                });
        }
        
        function evaluateTrainingQuality() {
            console.log('evaluateTrainingQuality called');
            document.getElementById('training-status').textContent = 'Evaluating training data quality...';
            fetch('/api/evaluate-training-quality', { method: 'POST' })
                .then(response => response.text())
                .then(message => {
                    document.getElementById('training-status').innerHTML = message.replace(/\n/g, '<br>');
                    setTimeout(() => document.getElementById('training-status').textContent = '', 15000);
                })
                .catch(error => {
                    document.getElementById('training-status').textContent = 'Error: ' + error.message;
                });
        }
        
        function blinkAIMove(row, col) {
            const boardElement = document.getElementById('chess-board');
            if (!boardElement || !boardElement.children[row] || !boardElement.children[row].children[col]) {
                return;
            }
            
            const square = boardElement.children[row].children[col];
            
            // Blink green 3 times
            setTimeout(() => {
                square.style.backgroundColor = '#00ff00';
                setTimeout(() => {
                    square.style.backgroundColor = '';
                    setTimeout(() => {
                        square.style.backgroundColor = '#00ff00';
                        setTimeout(() => {
                            square.style.backgroundColor = '';
                            setTimeout(() => {
                                square.style.backgroundColor = '#00ff00';
                                setTimeout(() => {
                                    square.style.backgroundColor = '';
                                }, 300);
                            }, 300);
                        }, 300);
                    }, 300);
                }, 300);
            }, 100);
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7/bundles/stomp.umd.min.js"></script>
    <script>
        // Make Stomp available globally
        const Stomp = StompJs.Stomp;
    </script>
    <script src="app.js"></script>
</body>
</html>